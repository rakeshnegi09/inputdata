<!-- Modal -->
<div id="myModalEmailWishlistEnquiry" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Enquire about Products</h4>
      </div>
      <div class="modal-body">
		<p><strong>Filling in your details below will enable us to contact you with a customised quote and answer any queries you have. We will be able to see which products you have shortlisted.</strong></p>
        <form action="" method="POST" target="_blank" class="form-inline">
		<div class="row">
			<div class="form-group ">
				<div class="col-sm-6">
				<label for="fname" >First Name:</label>
				<input type="text" required class="form-control" id="fname" name="fname">
				</div>
				<div class="col-sm-6">
				<label for="lname" >Last Name:</label>
				<input type="text" required class="form-control" id="lname" name="lname">
				</div>
			</div>			
		</div>  
		<div class="row">
			<div class="form-group ">
				<div class="col-sm-6">
				<label for="email" >Email:</label>
				<input type="email" required class="form-control" id="email" name="email">
				</div>
				<div class="col-sm-6">
				<label for="phone" >Phone Number:</label>
				<input type="text" required class="form-control" id="phone" name="phone">
				</div>
			</div>			
		</div>
		<!--div class="form-group">
			<label for="grave">Grave Location:</label>
			<input type="text" required class="form-control" id="grave" name="grave">
			<span style="font-size:12px;line-height:0;">Grave location details will enable us to check which memorial sizes are permitted on your plot and confirm any cemetery application fees.</span>
		  </div-->
		 <div class="form-group">
		  <label for="comment">Message:</label>
		  <textarea required class="form-control" rows="5" name="message" id="comment"></textarea>
		  
		</div>
		<!--div class="form-group">
		  <label for="inscription">Inscription Text:</label>
		  <textarea required class="form-control" rows="5" name="inscription" id="inscription"></textarea>
		 </div-->
		
      </div>
      <div class="modal-footer">
		<input type="submit" class="btn btn-primary" name="enquire_wishlist" value="Submit">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
	  </form>
    </div>

  </div>
</div>




<!-- Modal -->
<div id="myModalEmailWishlist" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">E-mail Shortlist</h4>
      </div>
      <div class="modal-body">
		<p><strong>Enter an email address below and we will send them details of this product.

Please note: this email will not be sent to our sales staff so if you have a question or need a quote please click the ‘Make Enquiry’ button instead.</strong></p>
        <form action="" method="POST">
		 <div class="form-group">
			<label for="email">Email address:</label>
			<input type="email" required class="form-control" id="email" name="email">
		  </div>
		 <div class="form-group">
		  <label for="comment">Message:</label>
		  <textarea required class="form-control" rows="5" name="comment" id="comment"></textarea>
		</div>
		
		
      </div>
      <div class="modal-footer">
		<input type="submit" class="btn btn-primary" name="email_wishlist" value="Submit">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
	  </form>
    </div>

  </div>
</div>





/***********************wishlist mobile***********************/

<!-- Modal -->
<div id="myModalEmailWishlistEnquiry" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Enquire about Products</h4>
      </div>
      <div class="modal-body">
		<p><strong>Filling in your details below will enable us to contact you with a customised quote and answer any queries you have. We will be able to see which products you have shortlisted.</strong></p>
        <form action="" method="POST" target="_blank" class="form-inline">
		<div class="row">
			<div class="form-group ">
				<div class="col-sm-6">
				<label for="fname" >First Name:</label>
				<input type="text" required class="form-control" id="fname" name="fname">
				</div>
				<div class="col-sm-6">
				<label for="lname" >Last Name:</label>
				<input type="text" required class="form-control" id="lname" name="lname">
				</div>
			</div>			
		</div>  
		<div class="row">
			<div class="form-group ">
				<div class="col-sm-6">
				<label for="email" >Email:</label>
				<input type="email" required class="form-control" id="email" name="email">
				</div>
				<div class="col-sm-6">
				<label for="phone" >Phone Number:</label>
				<input type="text" required class="form-control" id="phone" name="phone">
				</div>
			</div>			
		</div>
		<!--div class="form-group">
			<label for="grave">Grave Location:</label>
			<input type="text" required class="form-control" id="grave" name="grave">
			<span style="font-size:12px;line-height:0;">Grave location details will enable us to check which memorial sizes are permitted on your plot and confirm any cemetery application fees.</span>
		  </div-->
		 <div class="form-group">
		  <label for="comment">Message:</label>
		  <textarea required class="form-control" rows="5" name="message" id="comment"></textarea>
		  
		</div>
		<!--div class="form-group">
		  <label for="inscription">Inscription Text:</label>
		  <textarea required class="form-control" rows="5" name="inscription" id="inscription"></textarea>
		 </div-->
		
      </div>
      <div class="modal-footer">
		<input type="submit" class="btn btn-primary" name="enquire_wishlist" value="Submit">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
	  </form>
    </div>

  </div>
</div>




<!-- Modal -->
<div id="myModalEmailWishlist" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">E-mail Shortlist</h4>
      </div>
      <div class="modal-body">
		<p><strong>Enter an email address below and we will send them details of this product.

Please note: this email will not be sent to our sales staff so if you have a question or need a quote please click the ‘Make Enquiry’ button instead.</strong></p>
        <form action="<?php echo $_SERVER['REQUEST_URI']; ?>" method="POST">
		 <div class="form-group">
			<label for="email">Email address:</label>
			<input type="email" required class="form-control" id="email" name="email">
		  </div>
		 <div class="form-group">
		  <label for="comment">Message:</label>
		  <textarea required class="form-control" rows="5" name="comment" id="comment"></textarea>
		</div>
		
		
      </div>
      <div class="modal-footer">
		<input type="submit" class="btn btn-primary" name="email_wishlist" value="Submit">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
	  </form>
    </div>

  </div>
</div>



<style>
.woocommerce ul.products li.product .button {
    margin-top: 0;
    margin-right: 60% !important;
}
.woocommerce .wishlist-title {
     margin-bottom: 0px !important;
}
</style>
<div class="row">

  
   <?php

	if ( $wishlist && $wishlist->has_items() ) { ?>
	


	<?php if(isset($_POST['enquire_wishlist']) && $_POST['enquire_wishlist']=="Submit"){
	   $html .= "<p>Below is the details of the enquiry of the product</p>";
	   $html .= "First Name: ".$_POST['fname'];$html .="<br>";
	   $html .= "Last Name: ".$_POST['lname'];$html .="<br>";
	   $html .= "Email: ".$_POST['email'];$html .="<br>";
	   $html .= "Phone No: ".$_POST['phone'];$html .="<br>";
	   //$html .= "Grave Location: ".$_POST['grave'];$html .="<br>";
	   $html .= "Message: ".$_POST['message'];$html .="<br>";
	  // $html .= "Inscription Text: ".$_POST['inscription'];$html .="<br>";
	   $html .="<br>";
	   $html .= "<p>Below is the details of the wishlist product</p>";
	   
	  foreach ( $wishlist_items as $item ) {
			global $product;
			
			$product      = $item->get_product();
			$availability = $product->get_availability();
			$stock_status = isset( $availability['class'] ) ? $availability['class'] : false;

			if ( $product && $product->exists() ) {
				$html .="<br>";
				$html .= "<a href=".esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ).">";
				$html .= wp_kses_post( $product->get_image());
				$html .="<br>";
				$html .= wp_kses_post( $item->get_formatted_product_price() );
				$html .="<br>";
				$html .= wp_kses_post( apply_filters( 'woocommerce_in_cartproduct_obj_title', $product->get_title(), $product ) );
				$html .="</a>";
				$html .="<br>";				
				$html .="<br>";
			}
	  }
		
		$html .="<br>";
		$html .="<br>";
		$html .="Thank You!";
		$to = $_POST['email'];
		$to = "tomlinsonmemorials@gmail.com";
		$subject = "Product Email";
		$headers = array('Content-Type: text/html; charset=UTF-8');
		$sent = wp_mail($to, $subject, $html, $headers);
		  if($sent) {
				?>
				<div class="alert alert-success" role="alert">
				  Thank you for your interest. We have recived your email. Our team will get back to you soon.
				</div>
		<?php
		  }
	 } ?>

	
	   
  <?php if(isset($_POST['email_wishlist']) && $_POST['email_wishlist']=="Submit"){
	   $html .= "
		<p>Thank you for your interest in our products. Below is the list of products you have shortlisted:</p>

	   ";
	  foreach ( $wishlist_items as $item ) {
			global $product;

			$product      = $item->get_product();
			$availability = $product->get_availability();
			$stock_status = isset( $availability['class'] ) ? $availability['class'] : false;

			if ( $product && $product->exists() ) {
				$html .="<br>";
				$html .= "<a href=".esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ).">";
				$html .= wp_kses_post( $product->get_image());
				$html .="<br>";
				$html .= wp_kses_post( $item->get_formatted_product_price() );
				$html .="<br>";
				$html .= wp_kses_post( apply_filters( 'woocommerce_in_cartproduct_obj_title', $product->get_title(), $product ) );
				$html .="</a>";
				$html .="<br>";				
				$html .="<br>";
			}
	  }
		$html .="Message: ".$_POST['comment'];
		$html .="<br>";
		$html .="<br>";
		$html .="Thank You!";
		$to = get_option('admin_email');
		$to = $_POST['email'];
		$subject = "Product Email";
		$headers = array('Content-Type: text/html; charset=UTF-8');
		$sent = wp_mail($to, $subject, $html, $headers);
		  if($sent) {
				?>
				<div class="alert alert-success" role="alert">
				  Thank you for your interest!
				</div>
		<?php
		  }
	 } ?>
	 <!-- Trigger the modal with a button -->
		<p><strong>Below is the Wishlist of products you have shown interest in, please use the make enquiry button to email us your list so we can reply to you with further information on your selection or you can use the email feature to mail the Wishlist to yourself for future reference.</strong></p>
<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModalEmailWishlistEnquiry"> Enquire About Shortlist</button>
<button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModalEmailWishlist">Email Shortlist</button>

<p></p>
	 
	  <ul class="products">	
	 
	 <?php
	
	
		  
		foreach ( $wishlist_items as $item ) {
			/**
			 * Each of the wishlist items
			 *
			 * @var $item \YITH_WCWL_Wishlist_Item
			 */
			global $product;
			
			$terms = get_the_terms ( $item->get_product_id(), 'product_cat' );
			$display = "display_none";
			foreach ( $terms as $term ) {
				 $slug = $term->slug;
				 
				 if($slug == "special-offers"){
					 $display = "display_block";
				 }else{
					 $display = "display_none";
				 }
				 
				 break;
			}
			$product      = $item->get_product();
			$availability = $product->get_availability();
			$stock_status = isset( $availability['class'] ) ? $availability['class'] : false;

			if ( $product && $product->exists() ) {
				?>
      <li class="first last col-lg-3 col-md-3  product-box product-box post-<?php echo esc_attr( $item->get_product_id() ); ?> product type-product status-publish has-post-thumbnail product_cat-under-1000 first onbackorder shipping-taxable purchasable product-type-simple">
         <a href="<?php echo esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ); ?>" class="woocommerce-LoopProduct-link woocommerce-loop-product__link"></a>
		 <span class="custom_badge <?php echo $display;?>">
        <img src="https://tomlinsonmemorials.co.uk/wp-content/uploads/2021/11/badge.png" alt="10" />
    </span>
         <div class="fixit-product-featured-image">
            <a href="<?php echo esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ); ?>" class="woocommerce-LoopProduct-link woocommerce-loop-product__link wishlist-remove">
			<a href="<?php echo esc_url( $item->get_remove_url() ); ?>" class="remove_from_wishlist button" title="<?php echo esc_html( apply_filters( 'yith_wcwl_remove_product_wishlist_message_title', __( 'Remove this product', 'yith-woocommerce-wishlist' ) ) ); ?>"><?php esc_html_e( 'Remove', 'yith-woocommerce-wishlist' ); ?></a>
			<a href="<?php echo esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ); ?>">	<?php echo wp_kses_post( $product->get_image() ); ?></a>
            <div class="fixit-woocommerce-add-to-cart"></div>
           
         </div>
         <div class="fixit-product-details">
            <h3 class="shop-product-title"><a class="shop-heading" href="<?php echo esc_url( get_permalink( apply_filters( 'woocommerce_in_cart_product', $item->get_product_id() ) ) ); ?>"><?php echo wp_kses_post( apply_filters( 'woocommerce_in_cartproduct_obj_title', $product->get_title(), $product ) ); ?></a></h3>
            <div class="fixit-product-rating"></div>
            <div class="fixit-product-price">
               <span class="price"><?php echo wp_kses_post( $item->get_formatted_product_price() ); ?></span>
            </div>
         </div>
      </li>
	<?php } }  }else{ ?>
	
	<h3 class="text-center">No Records in Wishlist</h3><br><br>
	<?php } ?>
   </ul>
   
</div>



/****************quickview******************************/
<style>
.QuickViewBtn a{pointer-events:none;}
</style>


<script>
	 jQuery(document).on("click","a",function() {
		 var id =jQuery(this).attr("data-product_id");
		 var URL =jQuery(".post-"+id+" a").attr("href");
		 
		 console.log(id);
		 console.log(URL);
		 //jQuery('.QuickViewBtn a').attr("disabled","disabled");
		 setTimeout(
		  function() 
		  {
			  jQuery(".QuickViewBtn a").css("pointer-events","auto");
			 jQuery(".QuickViewBtn a").attr("href",URL);

		  }, 2000);
	  });
</script>

/****************************function.php*****************************/

<?php

add_filter("wpseo_breadcrumb_links", "wpse_100012_override_yoast_breadcrumb_trail");

function wpse_100012_override_yoast_breadcrumb_trail($links)
{
    $post_type = get_post_type();
	foreach($links as $row){
		if($row['text'] == "Memorials"){
			$row['url'] = "https://tomlinsonmemorials.co.uk/memorials/";
		}
		$final_link[] = $row;
	}
    return $final_link;
}

function my_custom_action() { 
    echo '<h5 style="text-align: center;margin-bottom: -5%;"><strong>Select an option box below & use the MAKE ENQUIRY button for further info</strong></h5>';
}   
add_action( 'woocommerce_single_product_summary', 'my_custom_action', 15 ); 

add_filter( 'wp_mail_from_name', 'my_mail_from_name' );
function my_mail_from_name( $name ) {
    return "tomlinsonmemorials"; 
}

add_filter( 'wp_mail_from', 'my_mail_from' );
function my_mail_from( $email ) {
    return "admin@tomlinsonmemorials.co.uk";
}

add_filter('pre_get_posts','lw_search_filter_pages');
function lw_search_filter_pages($query) {
    // Frontend search only
    if ( ! is_admin() && $query->is_search() ) {
        $query->set('post_type', 'product');
        $query->set( 'wc_query', 'product_query' );
    }
    return $query;
}

function __search_by_title_only( $search, $wp_query )
{
    global $wpdb;
    if(empty($search)) {
        return $search; // skip processing - no search term in query
    }
    $q = $wp_query->query_vars;
    $n = !empty($q['exact']) ? '' : '%';
    $search =
    $searchand = '';
    foreach ((array)$q['search_terms'] as $term) {
        $term = esc_sql($wpdb->esc_like($term));
        $search .= "{$searchand}($wpdb->posts.post_title LIKE '{$n}{$term}{$n}')";
        $searchand = ' AND ';
    }
    if (!empty($search)) {
        $search = " AND ({$search}) ";
        if (!is_user_logged_in())
            $search .= " AND ($wpdb->posts.post_password = '') ";
    }
    return $search;
}
add_filter('posts_search', '__search_by_title_only', 500, 2);


add_action( 'wpcf7_before_send_mail', 'wpcf7_add_text_to_mail_body', 10, 3 );;

function wpcf7_add_text_to_mail_body($contact_form, $abort, $submission){
  $form_id = $contact_form->id();
 if ($form_id == 4189 || $form_id == 4187): // 123 => Your Form ID.
     $values_list = $_POST['valsitems'];
     $values_str = implode(", ", $values_list);
	
	$product_id = $_POST['product-id'];
	
	if ( ( $product_id > 0 ) && is_numeric( $product_id ) ) {
		// Create a product object...
		$product = wc_get_product( $product_id );
		$get_permalink = get_permalink( $product_id);
		// checking that the ID is a valid product...
		if ( is_object( $product ) ) {
			// then get the product image url.
			$product_image_url = wp_get_attachment_image_src( $product->get_image_id(), 'large' )[ 0 ];
			if ( $product_image_url ) {
				$data_image = "<p style='margin-top:3%'><a href='".$get_permalink."'><img width='300px' height='300px' src='".$product_image_url."'></a></p>";
				
			}
		}
	}
	
	// get mail property
	$mail = $contact_form->prop( 'mail' ); // returns array 

	// add content to email body
	$mail['body'] .= $data_image;
	$mail['body'] .= $values_list;


     // set mail property with changed value(s)
     $contact_form->set_properties( array( 'mail' => $mail ) );
 endif;

}


/***********************************slider*******************************/

?>


		
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.slick/1.3.15/slick.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.slick/1.3.15/slick.css">

			<script>
			$(document).ready(function() {
				$('.slider').slick({
					slidesToShow: 3,
					slidesToScroll: 1,
					autoplaySpeed: 2000,
					dots: false,
					arrows: true,					
					infinite: true,
					autoplay:true,
					 slide: 'a',
					 cssEase: 'linear'
					 
				});	

			});
			</script>
		<div class="center slider">
		<?php 
		global $product;
		$id = $product->get_id();
		$array_data = wc_get_related_products($id, 99, array());
		foreach($array_data as $row) { 
		$product_data = wc_get_product( $row );
		$src = wp_get_attachment_url( $product_data->get_image_id());
		$url = get_permalink( $row);
		
		?>
		  
			<a href="<?= $url; ?>"><img src="<?= $src; ?>"/></a>
		 
		<?php } ?>
		
		 </div>	
		</div>
		<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12 summry-details summary entry-summary">
			<div class="summary entry-summary">	
			
				<?php
					/**
					 * woocommerce_single_product_summary hook.
					 *
					 * @hooked woocommerce_template_single_title - 5
					 * @hooked woocommerce_template_single_rating - 10
					 * @hooked woocommerce_template_single_price - 10
					 * @hooked woocommerce_template_single_excerpt - 20
					 * @hooked woocommerce_template_single_add_to_cart - 30
					 * @hooked woocommerce_template_single_meta - 40
					 * @hooked woocommerce_template_single_sharing - 50
					 * @hooked WC_Structured_Data::generate_product_data() - 60
					 */
					do_action( 'woocommerce_single_product_summary' );
				?>
			</div>
		</div>
	</div><!-- .summary -->
page-memorial-work.php this is full page code


/********************searhc/*************************/

<?php
/*
 *  Content Search Result Template.
 */ 
 
 error_reporting(E_ERROR | E_PARSE);
global $product;
$id = $product->get_id();
$terms = get_the_terms ( $id, 'product_cat' );
$display = "display_none";
foreach ( $terms as $term ) {
	 $slug = $term->slug;
	 
	 if($slug == "special-offers"){
		 $display = "display_block";
	 }else{
		 $display = "display_none";
	 }
	 
	 break;
}

$image = wp_get_attachment_image_src( get_post_thumbnail_id( $id ), 'single-post-thumbnail' );
?>


<li class="<?php if($count == 1 ){ ?> first clearboth last <?php } ?> col-lg-3 col-md-3 col-sm-6 col-xs-12  product-box product-box post- product type-product status-publish has-post-thumbnail product_cat-under-1000 first onbackorder shipping-taxable purchasable product-type-simple <?php if(!wp_is_mobile()){ ?>search_product_page<?php } ?>" style="min-height:430px">
	 <a href="<?php echo  get_permalink($id); ?>" class="woocommerce-LoopProduct-link woocommerce-loop-product__link">
	 <span class="custom_badge <?php echo $display;?>">
		<img src="https://tomlinsonmemorials.co.uk/wp-content/uploads/2021/11/badge.png" alt="10" />
	</span>
	</a>
	  <div class="fixit-product-featured-image">
            
			<a href="<?php echo  get_permalink($id); ?>">	
			<img width="100%" height="250px" style="min-height:280px" class="" src="<?php echo $image[0]; ?>"></a>
            <div class="fixit-woocommerce-add-to-cart"></div>
           
         </div>
         <div class="fixit-product-details">
            <h3 class="shop-product-title" style="padding-top:5px"><a class="shop-heading" href="<?php echo  get_permalink($id); ?>"><?php echo  get_the_title($id); ?></a></h3>
          
            <div class="fixit-product-price">
               <span class="price">£<?php echo $product->get_price();?></span>
            </div>
         </div>
  </li>
  <?php $count++ ;?>
	
	
	